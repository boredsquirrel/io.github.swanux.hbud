app-id: io.github.swanux.hbud
runtime: org.gnome.Platform
runtime-version: '41'
sdk: org.gnome.Sdk
command: io.github.swanux.hbud

finish-args:
  - --share=network
  - --socket=x11
  - --device=dri
  - --socket=pulseaudio
  - --filesystem=host
  - --share=ipc
  - --device=all
  - --filesystem=xdg-run/gvfs

cleanup:
  - "/lib/cmake"
  - "*.la"
  - "*.a"
  - "/share/doc"
  - "/share/gtk-doc"
  - "/share/locale"
  - "/share/runtime"
  - "/share/kde4"
  - "/share/metainfo"
  - "/share/vlc"
  - "/share/icons/hicolor/16x16"
  - "/share/icons/hicolor/32x32"
  - "/share/icons/hicolor/48x48"
  - "/share/icons/hicolor/256x256"
  - "/share/icons/hicolor/128x128/apps/vlc*.png"
  - "/share/applications/vlc.desktop"
  - "/bin/pylupdate5"
  - "/bin/pyrcc5"
  - "/bin/pyuic5"
  - "/include"
  - "/lib/debug"
  - "/lib/pkgconfig"
  - "/share/man"

modules:
  - name: io.github.swanux.hbud
    buildsystem: simple
    sources:
      - type: archive
        url: https://github.com/swanux/hbud/archive/refs/tags/v0.3.5.tar.gz
        sha256: ac5f5e0ba1a9f3023a00dd827951ba8dcc70d91788a59977b449bd8d27918876
    build-commands:
      - mkdir -p /app/share/applications
      - mkdir -p /app/share/hbud
      - mkdir -p /app/bin
      - mkdir -p /app/share/appdata
      - mkdir -p /app/share/icons/hicolor/128x128/apps
      - cp -r DEV_FILES/hbud /app/share/hbud/.
      - cp -r DEV_FILES/modules /app/share/hbud/. 
      - cp DEV_FILES/io.github.swanux.hbud.desktop /app/share/applications/.
      - cp DEV_FILES/io.github.swanux.hbud /app/share/hbud/.
      - ln -s /app/share/hbud/io.github.swanux.hbud /app/bin/.
      - cp DEV_FILES/io.github.swanux.hbud.appdata.xml /app/share/appdata/.
      - install -Dm644 -t /app/share/icons/hicolor/scalable/apps/ DEV_FILES/hbud/icons/io.github.swanux.hbud.svg 
      - cp DEV_FILES/fpcalc /app/bin/.

  - name: chromaprint
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_SHARED_LIBS=ON
      - -DCMAKE_POSITION_INDEPENDENT_CODE=ON
    sources:
      - type: archive
        url: https://github.com/acoustid/chromaprint/releases/download/v1.5.1/chromaprint-1.5.1.tar.gz
        sha256: a1aad8fa3b8b18b78d3755b3767faff9abb67242e01b478ec9a64e190f335e1c

  - name: libvlc
    sources:
      - type: archive
        url: https://get.videolan.org/vlc/3.0.17/vlc-3.0.17.tar.xz
        sha256: 48bd9bf337aa107a1524eba57c52dc4a91e29f5a97fbdee92f6a4dba90383cd0
      - type: patch
        path: vlc-ignore-time-for-cache.patch
    rm-configure: true
    cleanup:
      - /share/macosx
    config-opts:
      - BUILDCC=/usr/bin/gcc -std=gnu99
      - --disable-lua
      - --disable-a52
      - --disable-qt
      - --disable-ncurses
      - --disable-udev
      - "--disable-archive"
      - "--disable-live555"
      - "--disable-dc1394"
      - "--disable-dv1394"
      - "--disable-linsys"
      - "--disable-dvdread"
      - "--disable-dvdnav"
      - "--disable-bluray"
      - "--disable-opencv"
      - "--disable-smbclient"
      - "--disable-dsm"
      - "--disable-sftp"
      - "--disable-nfs"
      - "--disable-smb2"
      - "--disable-v4l2"
      - "--disable-decklink"
      - "--disable-vcd"
      - "--disable-libcddb"
      - "--disable-screen"
      - "--disable-vnc"
      - "--disable-freerdp"
      - "--disable-realrtsp"
      - "--disable-asdcp"
      - "--disable-sdl-image"
      - "--disable-skins2"
      - "--disable-alsa"
      - "--disable-goom"
      - "--disable-projectm"
      - "--disable-vsxu"
      - "--disable-avahi"
      - "--disable-mtp"
      - "--disable-upnp"
      - "--disable-microdns"
      - "--disable-libgcrypt"
      - "--disable-secret"
      - "--disable-kwallet"
      - "--disable-vlc"
      - "--disable-sout"
      - "--disable-vlm"
      - "--disable-debug"
      - "--disable-update-check"
      - "--disable-maintainer-mode"
      - "--disable-dependency-tracking"
      - "--enable-flac"
      - "--enable-ffmpeg"
